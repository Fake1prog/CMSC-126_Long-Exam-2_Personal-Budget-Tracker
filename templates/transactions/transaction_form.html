{% extends 'base.html' %}

{% block title %}{{ title }} | Gastadorcheck{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">{{ title }}</h2>

    <div class="bg-white rounded-lg shadow-md p-6">
        <form method="POST">
            {% csrf_token %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">{{ form.title.label }}</label>
                    {{ form.title }}
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">{{ form.amount.label }}</label>
                    {{ form.amount }}
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">{{ form.date.label }}</label>
                    {{ form.date }}
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">{{ form.type.label }}</label>
                    {{ form.type }}
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">{{ form.category.label }}</label>
                    {{ form.category }}
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">{{ form.notes.label }}</label>
                    {{ form.notes }}
                </div>
            </div>

            <div class="flex space-x-2 mt-4">
                <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition">
                    Save Transaction
                </button>
                <a href="{% url 'transaction_list' %}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded transition">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
    const typeSelect = document.querySelector('.transaction-type-select');
    const categorySelect = document.querySelector('.category-select');
    
    // Function to filter categories based on transaction type
    function updateCategoryOptions() {
        const selectedType = typeSelect.value;
        const currentValue = categorySelect.value;
        
        // Make an AJAX request to get filtered categories
        fetch(`/transactions/get-categories/?type=${selectedType}`)
            .then(response => response.json())
            .then(data => {
                // Clear existing options
                categorySelect.innerHTML = '';
                
                // Add placeholder option
                const placeholderOption = document.createElement('option');
                placeholderOption.value = '';
                placeholderOption.textContent = '---------';
                categorySelect.appendChild(placeholderOption);
                
                // Add filtered category options
                data.categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    // Add data attributes for enhanced display
                    option.setAttribute('data-color', category.color);
                    option.setAttribute('data-icon', category.icon || '');
                    categorySelect.appendChild(option);
                });
                
                // Try to restore the previous selection if it exists in the new options
                if (currentValue) {
                    const exists = Array.from(categorySelect.options).some(opt => opt.value === currentValue);
                    if (exists) {
                        categorySelect.value = currentValue;
                    }
                }
            });
    }
    
    // Update categories when transaction type changes
    if (typeSelect) {
        typeSelect.addEventListener('change', updateCategoryOptions);
    }
});
</script>
{% endblock %}

