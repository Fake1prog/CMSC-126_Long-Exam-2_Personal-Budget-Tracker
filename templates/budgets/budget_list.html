{% extends 'base_dashboard.html' %}

{% block title %}Budgets | Gastadorcheck{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="/static/css/landing.css">
{% endblock %}

{% block body_classes %}home-page{% endblock %}

{% block content %}
    <div class="my-8 container mx-auto max-w-6xl px-4"> <!-- Increased max-width -->
        <!-- Budget Title -->
<div class="mb-6 flex justify-between items-center">
    <div class="flex items-center">
        <h2 class="text-3xl flex flex-wrap items-baseline">
            <span class="font-semibold text-[#FF4300] ml-1">Budgets</span>
        </h2>
    </div>
    <div class="flex items-center">
        <!-- Info Icon with Tooltip -->
        <div class="relative mr-3" x-data="{ showTooltip: false }">
            <button @mouseenter="showTooltip = true" @mouseleave="showTooltip = false" 
                    class="w-6 h-6 rounded-full bg-white bg-opacity-40 flex items-center justify-center text-gray-500 hover:bg-opacity-60 transition focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </button>
            
            <!-- Tooltip Content -->
            <div x-show="showTooltip" 
                 class="absolute right-0 z-10 mt-2 w-72 origin-top-right rounded-[20px] bg-gradient-to-br from-rose-50 to-amber-50 bg-opacity-90 backdrop-filter backdrop-blur-lg border border-white border-opacity-20 shadow-lg p-4 transition-all duration-200 ease-in-out"
                 style="display: none;">
                <div class="text-gray-700">
                    <h3 class="text-lg font-semibold mb-3">About Budgets</h3>
                    
                    <div class="mb-4">
                        <h4 class="font-medium text-gray-700 mb-2">Budget Insights</h4>
                        <ul class="space-y-1 text-sm">
                            <li class="flex items-start">
                                <svg class="h-4 w-4 text-green-500 mr-1 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>Set budget limits for your spending categories</span>
                            </li>
                            <li class="flex items-start">
                                <svg class="h-4 w-4 text-green-500 mr-1 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>Track your spending against your budget goals</span>
                            </li>
                            <li class="flex items-start">
                                <svg class="h-4 w-4 text-green-500 mr-1 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>Easily identify where you're overspending</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-700 mb-2">Budget Tips</h4>
                        <ul class="space-y-1 text-sm">
                            <li class="flex items-start">
                                <svg class="h-4 w-4 text-amber-500 mr-1 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>Set realistic budgets based on your spending history</span>
                            </li>
                            <li class="flex items-start">
                                <svg class="h-4 w-4 text-amber-500 mr-1 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>Review and adjust your budgets monthly</span>
                            </li>
                            <li class="flex items-start">
                                <svg class="h-4 w-4 text-amber-500 mr-1 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>Use different budget periods for different expenses</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <a href="{% url 'budget_add' %}" class="bg-[#FD9069] hover:opacity-90 text-white h-10 px-4 rounded-[15px] flex items-center transition">
            Add Budget
        </a>
    </div>
</div>

        <!-- Budgets Content - Wider container with reduced corner radius -->
        <div class="bg-white bg-opacity-30 backdrop-filter backdrop-blur-lg border border-white border-opacity-20 rounded-[30px] shadow p-6 w-full"> <!-- Changed from rounded-[40px] to [30px] and added w-full -->
            {% if budgets %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"> <!-- Added responsive grid columns -->
                    {% for budget in budgets %}
                        <div class="bg-white bg-opacity-40 backdrop-filter backdrop-blur-sm rounded-[20px] p-6 hover:shadow-md transition"> <!-- Changed from rounded-[30px] to [20px] -->
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-semibold text-xl">{{ budget.category.name }}</h3>
                                <span class="text-sm text-gray-600 bg-white bg-opacity-40 px-3 py-1 rounded-full">{{ budget.get_period_display }}</span>
                            </div>

                            <div class="mb-4">
                                <div class="flex justify-between gap-2 text-base text-gray-600 mb-2">
                                    <span>Budget: â‚±{{ budget.amount }}</span>
                                    <span>Spent: â‚±{{ budget.spent }}</span>
                                </div>

                                <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                                    {% if budget.amount > 0 %}
                                        {% with percentage=budget.spent|floatformat:2 %}
                                            {% if budget.is_over %}
                                                <div class="h-3 rounded-full bg-red-600" style="width: 100%"></div>
                                            {% else %}
                                                <div class="h-3 rounded-full
                                                    {% if percentage > 80 %}bg-yellow-500{% else %}bg-green-600{% endif %}"
                                                    style="width: {{ percentage }}%"> 
                                                </div>
                                            {% endif %}
                                        {% endwith %}
                                    {% endif %}
                                </div>

                                <p class="text-base font-medium {% if budget.is_over %}text-red-600{% elif budget.remaining <= budget.amount|floatformat:2 %}text-yellow-500{% else %}text-green-600{% endif %}">
                                    {% if budget.is_over %}
                                        Over budget by â‚±{{ budget.remaining|floatformat:2 }}
                                    {% else %}
                                        â‚±{{ budget.remaining|floatformat:2 }} remaining
                                    {% endif %}
                                </p>
                            </div>

                            <div class="text-sm text-gray-500 mb-4 space-y-1">
                                <p>Start date: {{ budget.start_date }}</p>
                                {% if budget.end_date %}
                                    <p>End date: {{ budget.end_date }}</p>
                                {% endif %}
                            </div>

                            <div class="flex space-x-4">
                                <a href="{% url 'budget_edit' budget.id %}" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                                    Edit
                                </a>
                                <a href="{% url 'budget_delete' budget.id %}" class="text-red-600 hover:text-red-800 text-sm font-medium">
                                    Delete
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-10 w-full"> <!-- Added w-full -->
                    <div class="text-gray-400 text-5xl mb-4">ðŸ’°</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">No budgets yet</h3>
                    <p class="text-gray-500 italic mb-4">You don't have any budgets set up yet.</p>
                    <a href="{% url 'budget_add' %}" class="bg-[#FD9069] hover:opacity-90 text-white px-4 py-2 rounded-[15px] transition inline-flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                        Create Your First Budget
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block footer %}
    <footer class="home-footer">
        <p>&copy; {% now "Y" %} GastadorCheck Budget Tracker. All rights reserved.</p>
    </footer>
{% endblock %}